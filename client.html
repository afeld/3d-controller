<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>JS Bin</title>
    <style>
      body {
        font-size: 3.5em;
      }
    </style>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      window.addEventListener('deviceorientation', function(event) {
        var obj = {
          alpha: event.alpha,
          beta: event.beta,
          gamma: event.gamma
        };

        document.body.innerHTML = '<pre><code>' + JSON.stringify(obj, null, 2) + '</code></pre>';
        socket.emit('gyro', obj);
      }, false);


      var lastTouchMove = null;

      document.addEventListener('touchend', function(event){
        lastTouchMove = null;
      }, false);

      var handleSingleDrag = function(event){
        if (lastTouchMove) {
          var lastTouch = lastTouchMove.touches[0];
          var touch = event.touches[0];

          // double-check that it's the same touch
          if (lastTouch.identifier === touch.identifier) {
            var dx = event.pageX - lastTouchMove.pageX;
            var dy = event.pageY - lastTouchMove.pageY;

            // check if it actually moved
            if (dx || dy) {
              var drag = {
                dx: dx,
                dy: dy
              };
              socket.emit('drag', drag);
            }
          }
        }
      };

      document.addEventListener('touchmove', function(event){
        if (event.touches.length === 1) {
          handleSingleDrag(event);
        } else {
          console.log('multi');
        }

        lastTouchMove = event;
        // don't scroll
        event.preventDefault();
      }, false);
    </script>
  </head>
  <body>

  </body>
</html>
